name: ğŸ›ï¸ Hyperion Empire - Auto Deploy

on:
  push:
    branches: [ main ]
  schedule:
    # Run 3x daily at 6 AM, 2 PM, and 8 PM UTC
    - cron: '0 6,14,20 * * *'
  workflow_dispatch:

jobs:
  deploy:
    name: Deploy to Vercel
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v3
      
    - name: ğŸŸ¢ Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ğŸ“¦ Install Dependencies
      run: npm ci
      env:
        PUPPETEER_SKIP_DOWNLOAD: true
        
    - name: ğŸ§ª Verify Installation
      run: |
        echo "âœ… Dependencies installed"
        npm list --depth=0 || true
        
    - name: ğŸš€ Deploy to Vercel
      run: |
        npm install -g vercel
        vercel deploy --prod --scope=${{ secrets.VERCEL_ORG_ID }} --token=${{ secrets.VERCEL_TOKEN }} --yes
                  env:
              VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
              VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
              VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID }}
  generate-content:
    name: Generate Content
    runs-on: ubuntu-latest
    if: github.event.schedule != ''
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v3
      
    - name: ğŸŸ¢ Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        
    - name: ğŸ“¦ Install Dependencies
      run: npm ci
      env:
        PUPPETEER_SKIP_DOWNLOAD: true
        
    - name: ğŸ¤– Generate Content
      run: npm run empire:generate
      env:
        GOOGLE_AI_API_KEY: ${{ secrets.GOOGLE_AI_API_KEY }}
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
        BLOG_GITHUB_TOKEN: ${{ secrets.BLOG_GITHUB_TOKEN }}
        GITHUB_TOKEN: ${{ secrets.BLOG_GITHUB_TOKEN }}
        BLOG_TARGET_OWNER: ${{ secrets.BLOG_TARGET_OWNER }}
        BLOG_TARGET_REPO: ${{ secrets.BLOG_TARGET_REPO }}
        BLOG_CONTENT_PATH: ${{ secrets.BLOG_CONTENT_PATH }}
        
    - name: ğŸ“ Content Published
      run: |
        echo "âœ… Content generation completed"
        echo "ğŸ¯ Blog posts published to: ${{ secrets.BLOG_TARGET_OWNER }}/${{ secrets.BLOG_TARGET_REPO }}"
        echo "ğŸŒ Live blog will be available at: https://w3jdev.com/blog/"
